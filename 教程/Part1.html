Part 2.åˆæ­¥äº†è§£TShockæ’ä»¶æ¨¡æ¿â€‹
æœ¬ç« ä½ å°†å­¦åˆ°ï¼š

TShockæ’ä»¶æ¨¡æ¿å„éƒ¨åˆ†çš„ä½œç”¨
TShockæ’ä»¶çš„åˆå§‹åŒ–é¡ºåº
æ–‡ä»¶ç»“æ„

ğŸ“‚MyFirstPlugin
â”œâ”€â”€ ğŸ“‚MyFirstPlugin //é¡¹ç›®æ–‡ä»¶å¤¹
â”‚   â”œâ”€â”€ ğŸ“‚bin //æ„å»ºäº§ç‰©
â”‚   â”‚   â””â”€â”€ ğŸ“‚Debug //Debugç¼–è¯‘æ¨¡å¼ä¸‹çš„æ„å»ºäº§ç‰©
â”‚   â”‚       â””â”€â”€ ğŸ“‚net6.0 //ç›®æ ‡.NETç‰ˆæœ¬ï¼Œ
â”‚   â”‚           â”œâ”€â”€ ğŸ“œMyfirstplugin.deps.json //ä¾èµ–æ¸…å•çš„æ–‡ä»¶ï¼Œç”¨ä¸åˆ°
â”‚   â”‚           â”œâ”€â”€ ğŸ“œMyfirstplugin.dll //æ’ä»¶æœ¬ä½“
â”‚   â”‚           â””â”€â”€ ğŸ“œMyfirstplugin.pdb //å’Œæ’ä»¶ä¸€èµ·å®‰è£…ï¼ŒæŠ¥é”™åå¯ä»¥æ˜¾ç¤ºç›¸å…³æ–¹æ³•åœ¨æºç ä¸­çš„è¡Œæ•°
|   |       ğŸ“‚Release //Releaseç¼–è¯‘æ¨¡å¼ä¸‹çš„æ„å»ºäº§ç‰©
â”‚   â”‚       â””â”€â”€ ğŸ“‚net6.0
â”‚   â”‚           â”œâ”€â”€ ğŸ“œMyfirstplugin.deps.json //åŒä¸Š
â”‚   â”‚           â”œâ”€â”€ ğŸ“œMyfirstplugin.dll //åŒä¸Š
â”‚   â”‚           â””â”€â”€ ğŸ“œMyfirstplugin.pdb //åŒä¸Š
â”‚   â”œâ”€â”€ ğŸ“‚obj //ç”¨äºå­˜æ”¾ç¼–è¯‘çš„ä¸´æ—¶æ–‡ä»¶ï¼Œ
â”‚   â”œâ”€â”€ ğŸ“œMyfirstplugin.csproj //é¡¹ç›®é…ç½®æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶çš„åå­—å†³å®šæ’ä»¶ç¨‹åºé›†çš„åå­—
â”‚   â”œâ”€â”€ ğŸ“œPlugin.cs //æ’ä»¶æœ¬ä½“æºç æ–‡ä»¶
â”‚   â”œâ”€â”€ ğŸ“œConfig.cs //æ’ä»¶é…ç½®ç›¸å…³æºç æ–‡ä»¶ï¼ŒæŒ‰éœ€æ·»åŠ 
â”‚   â””â”€â”€ ğŸ“œDatabase.cs //æ’ä»¶æ•°æ®åº“ç›¸å…³æºç æ–‡ä»¶ï¼ŒæŒ‰éœ€æ·»åŠ 
â””â”€â”€ ğŸ“œMyFirstPlugin.sln //é¡¹ç›®çš„è§£å†³æ–¹æ¡ˆï¼Œç”¨æ¥å­˜æ”¾é¡¹ç›®ç»„çš„é…ç½®
æ’ä»¶æ¨¡æ¿â€‹
ä»¥ä¸‹æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„TShockæ’ä»¶æ¨¡æ¿


using System.Reflection;
using Terraria;
using TerrariaApi.Server;
using TShockAPI;

namespace MyFirstPlugin;

[ApiVersion(2, 1)]
public class Plugin : TerrariaPlugin 
{
    
    //æ’ä»¶çš„åç§°
    public override string Name => "MyFirstPlugin";
    
    //æ’ä»¶ä½œè€…åå­—
    public override string Author => "Cai";
    
    //æ’ä»¶åŠŸèƒ½çš„ä¸€å¥è¯æè¿°
    public override string Description => "æˆ‘ä¹Ÿä¸çŸ¥é“è¿™ä¸ªæœ‰ä»€ä¹ˆç”¨"; 

    //æ’ä»¶çš„ç‰ˆæœ¬, å¯ä»¥é‡‡ç”¨æ—¥æœŸæ¥å‘½å, eg: 2024å¹´1æœˆ4æ—¥ç¬¬1ä¸ªç‰ˆæœ¬ -> new(2024, 1,4,1)
    public override Version Version => new(2024, 1,4,1);
    
    //æ’ä»¶çš„æ„é€ å™¨
    public Plugin(Main game) : base(game) 
    {
    }
    
    //æ’ä»¶åŠ è½½æ—¶æ‰§è¡Œçš„ä»£ç 
    public override void Initialize()
    {
        
    }
        
    //æ’ä»¶å¸è½½æ—¶æ‰§è¡Œçš„ä»£ç 
    protected override void Dispose(bool disposing)
    {
        if (disposing)
        {
        }
        
        base.Dispose(disposing);
    }
}
æ’ä»¶åŸºæœ¬ä¿¡æ¯â€‹
ä»¥ä¸‹ä»£ç å¯ä»¥è®¾ç½®æ’ä»¶çš„ä¸€äº›åŸºæœ¬ä¿¡æ¯ï¼Œæ’ä»¶åå»ºè®®æŒ‰ç…§åŠŸèƒ½å‘½åï¼Œä¸è¦èµ·å¥‡æ€ªåå­—(ä¾‹å¦‚"ç‚¸è£‚"), Author(æ’ä»¶ä½œè€…)ã€Name(æ’ä»¶åå­—)ã€Version(æ’ä»¶ç‰ˆæœ¬)å°†ä¼šåœ¨æ’ä»¶åˆå§‹åŒ–å®Œæˆæ—¶æ˜¾ç¤º
image


//æ’ä»¶çš„åç§°
public override string Name => "MyFirstPlugin";

//æ’ä»¶ä½œè€…åå­—
public override string Author => "Cai";

//æ’ä»¶åŠŸèƒ½çš„ä¸€å¥è¯æè¿°
public override string Description => "æˆ‘ä¹Ÿä¸çŸ¥é“è¿™ä¸ªæœ‰ä»€ä¹ˆç”¨"; 

//æ’ä»¶çš„ç‰ˆæœ¬, å¯ä»¥é‡‡ç”¨æ—¥æœŸæ¥å‘½å, eg: 2024å¹´1æœˆ4æ—¥ç¬¬1ä¸ªç‰ˆæœ¬ -> new(2024, 1,4,1)
public override Version Version => new(2024, 1,4,1);
æ³¨

ä½¿ç”¨new Version()å°†ä¼šæ˜¾ç¤ºæ­¤æ–¹æ³•å‚æ•°ä¸ºç‰ˆæœ¬å·
è€Œä½¿ç”¨Assembly.GetExecutingAssembly().GetName().Versionè·å–çš„æ˜¯ç¨‹åºé›†çš„ç‰ˆæœ¬å·, ç¨‹åºé›†ç‰ˆæœ¬å·éœ€è¦åœ¨é¡¹ç›®å±æ€§ä¸­ä¿®æ”¹


//æ’ä»¶çš„ç‰ˆæœ¬
public override Version Version => new Version(2024, 1,4,1); //ä»£ç ä¸­è®¾ç½®ç‰ˆæœ¬ (æ¨è)
public override Version Version =>
Assembly.GetExecutingAssembly().GetName().Version; //é¡¹ç›®ä¸­è®¾ç½®ç‰ˆæœ¬ (éº»çƒ¦)
ä¿®æ”¹ç¨‹åºé›†ç‰ˆæœ¬
æ’ä»¶çš„æ„é€ å™¨â€‹
æ’ä»¶çš„æ„é€ å™¨ï¼Œä¹Ÿå«æ„é€ å‡½æ•°ã€‚å½“TShockåˆ›é€ æ’ä»¶å¯¹è±¡æ—¶ï¼Œæ„é€ å‡½æ•°å°±ä¼šè¢«è°ƒç”¨ï¼Œæ„é€ å‡½æ•°ä¸­çš„ä»£ç ä¼šæ¯”Initializeæ–¹æ³•æ›´å…ˆæ‰§è¡Œã€‚æœåŠ¡ç«¯ä¼šå…ˆæŒ‰ç…§è¯»å–åˆ°æ’ä»¶çš„é¡ºåº(å–å†³äºæ’ä»¶çš„æ–‡ä»¶å)æ‰§è¡Œæ‰€æœ‰æ’ä»¶çš„æ„é€ å‡½æ•°ï¼Œå†æŒ‰ç…§Orderç”±å°åˆ°å¤§æ‰§è¡Œæ’ä»¶çš„Initializeæ–¹æ³•


//æ’ä»¶çš„æ„é€ å™¨
public Plugin(Main game) : base(game)
{
    /*
    æ’ä»¶åŠ è½½é¡ºåºï¼Œé»˜è®¤ä¸º1ï¼Œæ•°å­—è¶Šå°è¶Šå…ˆåŠ è½½
    å…¶ä¸­int.MaxValueæœ€æ™šåŠ è½½, int.MinValueæœ€å…ˆåŠ è½½
    TShockAPIçš„Orderä¸º0, æ‰€ä»¥Order < 0ä¼šæ¯”TShockæ›´ä¼˜å…ˆåŠ è½½, Order > 0,åˆ™ä¼šæ¯”TShockæ›´æ™šåŠ è½½
    å¦‚æœä½ ä¸æ˜¯æŒ‡Order, é‚£ä¹ˆOrderçš„é»˜è®¤å€¼ä¸º1,ä¼šæ¯”TShockæ™šåŠ è½½
    */
    base.Order = 1;
}
è­¦å‘Š

é€šå¸¸æƒ…å†µä¸‹ï¼Œæ„é€ å‡½æ•°çš„æ‰§è¡Œä¼šåœ¨TShockåˆå§‹åŒ–ä¹‹å‰
å¦‚æœåœ¨æ„é€ å‡½æ•°ä¸­ç¼–å†™ä»£ç (ä¾‹å¦‚å»ºè¡¨)ï¼Œå¯èƒ½ä¼šå¯¼è‡´ååˆ†ç„å­¦çš„é—®é¢˜ï¼Œæ‰€ä»¥æ²¡æœ‰ç‰¹æ®Šéœ€è¦ä¸‹ä¸€èˆ¬æ’ä»¶çš„æ„é€ å‡½æ•°éƒ½ä¼šç›´æ¥æ”¾ç©ºã€‚
å¦‚æœæ²¡æœ‰ç‰¹æ®Šéœ€è¦ä¹Ÿä¸è¦ä¿®æ”¹Order

æ’ä»¶çš„åˆå§‹åŒ–æ–¹æ³•
åˆå§‹åŒ–æ–¹æ³•æ˜¯TShockæ’ä»¶ä¸­éå¸¸é‡è¦çš„éƒ¨åˆ†ï¼Œè¿™ä¸ªå‡½æ•°ä¸»è¦è´Ÿè´£æ’ä»¶çš„åˆå§‹åŒ–ï¼Œå¯ä»¥ç”¨æ¥æ³¨å†Œé’©å­ã€æ·»åŠ å‘½ä»¤ã€æ³¨å†ŒREST APIå‘½ä»¤ã€åˆå§‹åŒ–é…ç½®æ–‡ä»¶ã€åˆå§‹åŒ–æ•°æ®åº“ç­‰


//æ’ä»¶åŠ è½½æ—¶æ‰§è¡Œçš„ä»£ç 
public override void Initialize()
{
    ServerApi.Hooks.ServerChat.Register(this, this.OnChat); //æ³¨å†Œé’©å­
    Commands.ChatCommands.Add(new Command("xsb.fishrank", Fish, "é’“é±¼æ’è¡Œ")); //æ·»åŠ å‘½ä»¤
    TShock.RestApi.Register(new SecureRestCommand("/XSB/GetMap", GetMap, "rest.xsb.admin")); //æ³¨å†ŒREST APIå‘½ä»¤
    Config.Instance.Read(); //åˆå§‹åŒ–é…ç½®æ–‡ä»¶
    DB.Init(); //åˆå§‹åŒ–æ•°æ®åº“
}
æ’ä»¶çš„å¸è½½æ–¹æ³•
æ’ä»¶çš„å¸è½½æ–¹æ³•åœ¨æ’ä»¶å¸è½½(é€šå¸¸æ˜¯TShockå…³é—­æ—¶)è¢«è°ƒç”¨ã€‚å¦‚æœä½ ä½¿ç”¨PluginLoader, é‚£ä¹ˆè¯·ä½ åŠ¡å¿…å†™å¥½å¸è½½æ–¹æ³•, å¦åˆ™ä¼šå¯¼è‡´æ’ä»¶çš„åŠŸèƒ½å¸è½½ä¸å®Œå…¨, é‡è½½å‡ºç°å¼‚å¸¸ã€‚


//æ’ä»¶å¸è½½æ—¶æ‰§è¡Œçš„ä»£ç 
protected override void Dispose(bool disposing)
{
     if (disposing)
     {
         ServerApi.Hooks.ServerChat.Deregister(this, this.OnChat);  //å¸è½½é’©å­
         Commands.ChatCommands.RemoveAll(c => c.CommandDelegate.Method?.DeclaringType?.Assembly == Assembly.GetExecutingAssembly()); //ç§»é™¤æ’ä»¶æ·»åŠ çš„å‘½ä»¤ (è¿™ä¸ªå¯ä»¥å¸è½½æ‰€æœ‰å‘½ä»¤,æ¨èæ¯ä¸ªæ’ä»¶éƒ½ä½¿ç”¨)
     }
     base.Dispose(disposing);
}
é‡è¦

æ³¨å†Œã€æ³¨é”€æœ‰å§‹æœ‰ç»ˆ


//æ³¨å†Œ Initialize
Commands.ChatCommands.Add(new Command("xsb.fishrank", Fish, "é’“é±¼æ’è¡Œ"));
ServerApi.Hooks.ServerChat.Register(this, this.OnChat); 
GetDataHandlers.KillMe.Register(OnKillMe);
PlayerHooks.PlayerPermission+= PlayerHooksOnPlayerPermission;
...
//æ³¨é”€ Dispose
Commands.ChatCommands.RemoveAll(c => c.CommandDelegate.Method?.DeclaringType?.Assembly == Assembly.GetExecutingAssembly());
ServerApi.Hooks.ServerChat.Deregister(this, this.OnChat); 
GetDataHandlers.KillMe.UnRegister(OnKillMe);
PlayerHooks.PlayerPermission-= PlayerHooksOnPlayerPermission;
